# Epic 5: Tavily Search 实时信息增强

## 状态: Planning

## 概述

集成 Tavily Search API 作为 Gemini AI 的工具，通过实时搜索提升关键词分析的准确性，解决AI对新兴词汇和公司名称的幻觉问题。

## 业务价值

### 问题陈述
- AI对新兴词汇、公司名称存在幻觉问题，可能提供过时或错误信息
- 用户对分析结果的可信度存疑，影响产品价值感知
- 缺乏信息来源透明度，用户无法验证分析结果

### 解决方案
- 通过 Tavily Search API 获取实时、准确的信息
- AI 智能判断是否需要搜索，优化用户体验
- 在UI中显示信息来源，增强可信度

### 预期收益
- **准确性提升**: 从 70% 提升到 90%+
- **用户信任度**: 提升 25%
- **用户留存**: 提升 15%

## 技术方案

### 核心架构
- **Function Calling**: Gemini AI 自主决定是否调用搜索工具
- **降级策略**: Tavily 不可用时自动降级到纯 AI 分析
- **智能触发**: 仅在用户提供Tavily Key并启用功能后，在需要时进行搜索，避免不必要的API调用

### 关键技术点
1. Vercel AI SDK 的 Function Calling 集成
2. Tavily Search API 调用和错误处理
3. UI 增强：数据来源显示
4. 智能降级策略和错误处理
5. Tavily API Key 配置和启用/禁用开关

## 用户故事

| Story ID | 标题 | 优先级 | 估算 | 状态 |
| :--- | :--- | :--- | :--- | :--- |
| **5.0** | [配置 Tavily API Key 和功能开关](./stories/5.0.story.md) | High | 2 | ✅ Ready |
| **5.1** | [集成 Tavily Search API](./stories/5.1.story.md) | High | 5 | 🚧 Blocked by 5.0 |
| **5.2** | [实现 Function Calling 架构](./stories/5.2.story.md) | High | 8 | 🚧 Blocked by 5.1 |
| **5.3** | [UI 增强：显示信息来源](./stories/5.3.story.md) | Medium | 3 | 🚧 Blocked by 5.2 |

**总估算**: 18 Story Points

## 验收标准

### 功能验收
- [ ] 用户可以在设置中配置和验证Tavily API Key
- [ ] 用户可以启用或禁用实时搜索功能
- [ ] 禁用实时搜索后，应用应回退到纯AI分析模式
- [ ] AI 能够在功能启用时自主决定是否需要搜索
- [ ] 搜索结果正确集成到分析中
- [ ] UI 显示信息来源和搜索状态
- [ ] 错误情况下能够降级到基础分析

### 性能验收
- [ ] 包含搜索的响应时间 < 800ms (P95)
- [ ] 基础分析响应时间 < 400ms (P95)
- [ ] 搜索 API 成功率 > 95%
- [ ] 降级策略响应时间 < 500ms

### 用户体验验收
- [ ] 搜索状态有明确的视觉反馈
- [ ] 信息来源链接可点击访问
- [ ] 错误状态有友好的提示信息
- [ ] 搜索失败时用户无感知切换到基础分析

## 风险和缓解

### 技术风险
1. **Tavily API 限制**
   - 风险: 免费额度用完或API不稳定
   - 缓解: 实现降级策略，监控使用量

2. **响应时间增加**
   - 风险: 搜索导致用户体验下降
   - 缓解: 智能触发策略，异步处理

3. **Function Calling 复杂性**
   - 风险: 实现复杂，调试困难
   - 缓解: 充分测试，详细日志

### 业务风险
1. **成本控制**
   - 风险: Tavily API 调用成本
   - 缓解: 智能触发策略（20-30%触发率），用户可选关闭

## 成功指标

### 技术指标
- 搜索触发率: 20-30%
- 搜索成功率: > 95%
- 响应时间: < 800ms (含搜索), < 400ms (纯分析)
- 降级成功率: > 99%

### 业务指标
- 用户满意度: +25%
- 分析准确性: +30%
- 用户留存率: +15%
- 错误报告: -50%

## 时间线

### Phase 1: 核心功能 (Week 1-2)
- Story 5.0: Tavily Key 配置
- Story 5.1: Tavily API 集成
- Story 5.2: Function Calling 实现

### Phase 2: 用户体验 (Week 3)
- Story 5.3: UI 增强和用户反馈
- 集成测试和性能调优

### Phase 3: 上线准备 (Week 4)
- 端到端测试
- 性能监控设置
- 文档完善

## 依赖关系

### 前置条件
- Epic 3 完成（基础 AI 分析功能）
- Gemini API 集成稳定
- 用户 onboarding 流程完善
- Epic 4 完成 (Onboarding 流程)

### 后续影响
- 为 Phase II 后端驱动的搜索奠定基础
- 支持未来的高级搜索功能
- 为其他 AI 工具集成提供模式

## 团队分工

- **架构师 Fred**: 技术架构设计，Function Calling 实现
- **前端开发 Ellyn**: UI 增强，用户体验优化
- **全栈开发 James**: API 集成，错误处理
- **产品经理 John**: 需求细化，验收测试
- **QA**: 功能测试，性能测试

## 为什么移除了 Story 5.4 和 5.5？

### Story 5.4 (错误处理和降级策略)
- **已集成到现有 Stories**: 错误处理逻辑已经包含在 5.1 和 5.2 中
- **避免重复工作**: 降级策略是 Function Calling 的核心部分
- **简化项目管理**: 减少不必要的 Story 分割

### Story 5.5 (性能优化和缓存策略)
- **缓存意义不大**: 关键词分析场景下重复查询概率极低
- **实时性要求**: 用户更需要最新信息而非缓存数据
- **过度工程**: 在 Chrome Extension 场景下缓存收益很小
- **维护成本**: 缓存逻辑增加复杂度但收益有限

### 优化后的优势
- **更聚焦**: 专注于核心功能实现
- **更高效**: 18 SP vs 原来的 24 SP，节省 25% 工作量
- **更简洁**: 减少不必要的技术复杂度
- **更快交付**: 3周完成 vs 原来的 4周 