# Story 2.1: 引导用户设置并验证 Gemini API Key

## Status: In Progress

## Story

- As a 新用户
- I want 在首次打开插件时，能被引导完成 Gemini API Key 的设置，并**立即验证其有效性**
- so that 插件可以正常工作，为后续的 AI 分析做好准备

## Acceptance Criteria (ACs)

1.  [x] 在 Onboarding 界面中，存在一个用于输入 API Key 的文本输入框。
2.  [x] 当用户输入 Key 后，系统会自动触发或通过点击按钮触发验证流程。
3.  [x] 调用 `ApiService` 对 Key 的有效性进行验证。
4.  [ ] 验证成功时，输入框旁显示成功状态（如绿色对勾），并提示用户。
5.  [ ] 验证失败时，输入框旁显示失败状态（如红色叉号），并给出明确的错误信息（例如："API Key 无效或已过期"）。
6.  [x] 验证成功的 API Key 会被 `StorageService` 安全地加密并持久化存储。
7.  [x] 整个验证过程应有加载状态提示，防止用户重复操作。

## Tasks / Subtasks

- [x] **Task 1: 构建 API Key 输入 UI**
  - [x] 在 `onboarding/ApiKeyForm.tsx` 组件中，添加一个 `<Input />` 组件用于接收 API Key。
  - [x] 添加一个"验证"或"下一步"按钮来触发验证逻辑。
  - [x] 在输入框旁边预留图标位置，用于显示成功/失败/加载状态。

- [x] **Task 2: 实现 API Key 验证逻辑**
  - [x] 在 `ApiKeyForm.tsx` 中，创建一个 state 来管理加载和验证状态。
  - [x] 当用户点击验证按钮时，调用 `apiService.validateApiKey(key)` 方法。
    - [x] *注意: `apiService` 需要新增一个 `validateApiKey` 方法，该方法可以做一个轻量级的 API 调用（如列出模型）来确认 Key 是否有效。*
  - [x] 根据 `apiService` 的返回结果，更新 UI 的状态（成功、失败、空闲）。

- [x] **Task 3: 集成存储服务**
  - [x] 在 API Key 验证成功后，调用 `storageService.setApiKey(key)` 将其保存。
  - [x] 调用 `storageService.setOnboardingComplete(true)` 来标记引导流程的一个关键步骤已完成。

- [ ] **Task 4: 完善用户体验**
  - [ ] 实现输入时的抖动延迟（debounce），避免用户每输入一个字符就触发验证。
  - [ ] 在 `ApiKeyForm.tsx` 中集成 `Toast` 组件，用于显示更详细的成功或失败信息。 