# Story 4.2: 将洞察报告下载为 CSV 文件

## Status: To Do

## Story

- As a 用户
- I want 我希望能将洞察报告**下载为 CSV 文件**
- so that 我可以在电子表格软件中对多个关键词的分析结果进行进一步的处理和比较

## Acceptance Criteria (ACs)

1.  [ ] 在 `InsightCard` 组件中，有一个"下载为 CSV"的按钮或菜单项。
2.  [ ] 点击按钮后，浏览器会触发一个文件下载操作。
3.  [ ] 下载的文件名为 `lexitrend-[keyword].csv`。
4.  [ ] CSV 文件的内容包含列头 `keyword,definition,cultural_context`。
5.  [ ] CSV 文件的内容包含对应的数据行，特殊字符（如逗号、引号）需要被正确转义。
6.  [ ] CSV 文件使用 UTF-8 编码，以保证多语言内容的兼容性。

## Tasks / Subtasks

- [ ] **Task 1: 添加下载按钮到 UI**
  - [ ] 在 `InsightCard.tsx` 组件的导出功能区，添加一个带有下载图标的 `<Button>`。

- [ ] **Task 2: 实现 CSV 生成和下载逻辑**
  - [ ] 在 `InsightCard.tsx` 中，创建一个 `handleDownloadCsv` 的事件处理函数。
  - [ ] 在函数中，定义 CSV 的列头：`const headers = "keyword,definition,cultural_context\\n";`。
  - [ ] 编写一个小的工具函数来转义 CSV 内容中的特殊字符（主要是双引号）。
  - [ ] 根据当前的 `insight` prop 数据，生成 CSV 的数据行。
  - [ ] 将列头和数据行拼接为完整的 CSV 字符串。

- [ ] **Task 3: 触发浏览器下载**
  - [ ] 创建一个 `Blob` 对象：`const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });`
    - *为了更好的 Excel 兼容性，可以在内容前加上 BOM 头: `\uFEFF` + csvContent*
  - [ ] 使用 `URL.createObjectURL(blob)` 创建一个临时的 URL。
  - [ ] 创建一个隐藏的 `<a>` 标签。
  - [ ] 设置 `<a>` 标签的 `href` 为该 URL，`download` 属性为目标文件名。
  - [ ] 调用 `<a>` 标签的 `.click()` 方法来触发下载。
  - [ ] 之后调用 `URL.revokeObjectURL(url)` 来释放内存。 