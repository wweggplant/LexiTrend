# Story 5.0: 配置 Tavily API Key 和功能开关

## 状态: Ready

## 用户故事

- As a 用户
- I want 在设置中配置我的 Tavily API Key 并能选择是否启用实时搜索
- so that 我可以控制应用的消费并根据需要增强分析能力

## 验收标准

### 功能要求
- [ ] 在设置界面 (SettingsDrawer) 中，增加一个用于输入 Tavily API Key 的文本框。
- [ ] 在 Tavily API Key 输入框旁边，增加一个"验证"按钮。
- [ ] 在设置界面中，增加一个开关 (Toggle Switch) 用于"启用/禁用实时搜索"。
- [ ] Tavily API Key 和开关的状态需要被持久化存储 (`chrome.storage.local`)。
- [ ] 实时搜索功能默认禁用。
- [ ] 只有当 Tavily API Key 存在且有效，并且用户启用了开关时，实时搜索功能才会被激活。
- [ ] 如果用户未提供 Key 或禁用了开关，应用应平滑降级到纯 AI 分析模式，不应有任何错误提示。

### UI/UX 要求
- [ ] Tavily API Key 输入框应放置在 Gemini API Key 输入框下方。
- [ ] 输入框应有清晰的标签，如"Tavily API 密钥 (可选)"。
- [ ] 应有辅助文本说明该 Key 的作用，例如："用于启用实时网络搜索，提升对新词汇的分析准确性。留空则禁用此功能。"
- [ ] "启用实时搜索"开关应有明确的标签。
- [ ] 验证过程应有状态反馈（如：验证中、验证成功、验证失败）。

## 技术说明

- **组件**: `src/components/onboarding/SettingsDrawer.tsx`
- **存储**: `src/services/storage.ts` 需要增加 `getTavilyApiKey`, `setTavilyApiKey`, `getSearchEnabled`, `setSearchEnabled` 等方法。
- **验证逻辑**: 可以在 `background.ts` 中创建一个新的消息类型 `VALIDATE_TAVILY_KEY`，通过向 Tavily API 发送一个低成本的测试查询来验证 Key 的有效性。

## 估算: 2 Story Points

### 复杂度分析
- **简单**: UI 组件修改。
- **简单**: 存储逻辑扩展。
- **中等**: API Key 验证逻辑的实现，涉及与 background script 的通信。

## 依赖关系

### 前置条件
- Epic 4 (Onboarding) 完成，`SettingsDrawer.tsx` 组件已存在。
- `StorageService` 已建立。

### 后续影响
- **Story 5.1**: 集成 Tavily Search API，将依赖于此处设置的 API Key 和开关状态。
- **Story 5.2**: Function Calling 的实现将依赖于此开关状态来决定是否启用工具。 