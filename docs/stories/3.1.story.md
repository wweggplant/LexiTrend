# Story 3.1: 在 Google Trends 页面自动识别并允许选择关键词

## Status: Review

## Story

- As a 用户
- I want 当我在 Google Trends 页面浏览时，插件需要能**自动识别出可供分析的关键词**
- so that 我可以方便地选择它们，并启动洞察分析流程

## Acceptance Criteria (ACs)

1.  [x] 当用户访问 `https://trends.google.com/` 及其子路径时，`content-script.ts` 会被成功注入。
2.  [x] Content Script 能够准确地识别出代表"关键词"的 DOM 元素。
3.  [x] 在每个识别出的关键词元素旁边，会动态添加一个 LexiTrend 的小图标或一个"分析"按钮。
4.  [x] 点击该图标/按钮后，会通过 `chrome.runtime.sendMessage` 将该关键词文本发送给 Background Service Worker。
5.  [x] Background Service Worker 收到消息后，会打开侧边栏 (`chrome.sidePanel.open`) 并将关键词数据传递给侧边栏应用。
6.  [x] 脚本对页面的性能影响应尽可能小，不能导致页面卡顿。

## Tasks / Subtasks

- [x] **Task 1: 实现关键词 DOM 节点识别**
  - [x] 在 `content-script.ts` 中，编写一个函数，使用稳健的 DOM 选择器来查找所有关键词元素。
  - [x] 使用 `MutationObserver` 来监听 DOM 变化，以便在页面内容动态加载（如用户进行新的搜索）时，也能重新识别关键词。

- [x] **Task 2: 动态注入交互元素**
  - [x] 设计一个用于触发分析的图标或按钮组件（可以是简单的 HTML 元素）。
  - [x] 编写一个函数，遍历所有已识别的关键词 DOM 节点，并在其旁边插入这个交互元素。
  - [x] 为每个注入的元素添加 `click` 事件监听器。

- [x] **Task 3: 实现消息通信**
  - [x] 在 `click` 事件监听器中，获取对应的关键词文本。
  - [x] 调用 `chrome.runtime.sendMessage`，发送一个包含 `{ type: 'ANALYZE_KEYWORD', payload: keyword }` 的消息。

- [x] **Task 4: 配置 Background 和 Side Panel 响应**
  - [x] 在 `background.ts` 中，设置一个 `chrome.runtime.onMessage` 监听器。
  - [x] 在监听器中，判断 `message.type`，如果是 `ANALYZE_KEYWORD`，则调用 `chrome.sidePanel.open()`。
    - *注意: `sidePanel.open` 需要指定 `windowId`。*
  - [x] 在侧边栏应用（`side-panel-app.tsx`）中，设置相应的监听器来接收关键词数据并更新 UI 状态。 